# TIL

## WebClient
- ì›ë˜ëŠ” í´ë¼ì´ì–¸íŠ¸ -> RAG ì„œë²„
- ì´ëŸ°ì‹ìœ¼ë¡œ ì§„í–‰ë˜ì—ˆìŒ.
- í´ë¼ì´ì–¸íŠ¸ -> ë°±ì—”ë“œ -> RAG
- ì´ ìˆœì„œë¡œ ë³€ê²½

```java
@Value("${rag.server}")
private String ragServerUrl;

@Bean
WebClient webClient(@Value("${rag.server}") String ragServerUrl, WebClient.Builder builder){
    HttpClient httpClient = HttpClient.create()
            .proxyWithSystemProperties(); 
    return builder.clientConnector(new ReactorClientHttpConnector(httpClient)).build();
}
```
- ë°ì´í„°ë¥¼ ì£¼ê³  ë°›ì„ ìˆ˜ ìˆê²Œ êµ¬í˜„

## WebSocket
- ì›ë˜ ì‚¬ìš©í•˜ë ¤ê³  í–ˆë˜ ì†Œì¼“ì€ ë‹¤ìŒë²ˆì— ì‚¬ìš©í•´ë´ì•¼ê² ë‹¤. ìš”ì²­ì„ ë°”íƒ•ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ê²°ê³¼ì—¬ì„œ ì†Œì¼“ì˜ ì˜ë¯¸ê°€ í¬ê²Œ ì—†ì—ˆë‹¤.
- í•˜ì§€ë§Œ ì†Œì¼“ ë‚´ë¶€ ê°œë…ì— ëŒ€í•´ ì•Œê²Œ ë¨

### WebSocket ì„œë²„ êµ¬í˜„ (Spring Boot)
```java
@Configuration
@EnableWebSocket
public class WebSocketConfig implements WebSocketConfigurer {
    @Override
    public void registerWebSocketHandlers(WebSocketHandlerRegistry registry) {
        registry.addHandler(new MyWebSocketHandler(), "/ws").setAllowedOrigins("*");
    }
}

@Component
public class MyWebSocketHandler extends TextWebSocketHandler {
    private static final Map<String, WebSocketSession> CLIENTS = new ConcurrentHashMap<>();

    @Override
    public void afterConnectionEstablished(WebSocketSession session) throws Exception {
        CLIENTS.put(session.getId(), session);
        System.out.println("WebSocket ì—°ê²° ì„±ê³µ: " + session.getId());
    }

    @Override
    protected void handleTextMessage(WebSocketSession session, TextMessage message) throws Exception {
        System.out.println("ë©”ì‹œì§€ ìˆ˜ì‹ : " + message.getPayload());
        session.sendMessage(new TextMessage("ì„œë²„ ì‘ë‹µ: " + message.getPayload()));
    }

    @Override
    public void afterConnectionClosed(WebSocketSession session, CloseStatus status) throws Exception {
        CLIENTS.remove(session.getId());
        System.out.println("WebSocket ì—°ê²° ì¢…ë£Œ: " + session.getId());
    }
}
```

### WebSocket í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„ (React Native)
```javascript
const connectWebSocket = () => {
  ws.current = new WebSocket(`ws://${serverIp}/ws`);

  ws.current.onopen = () => {
    console.log("âœ… WebSocket ì—°ê²° ì„±ê³µ");
  };

  ws.current.onmessage = (e) => {
    console.log("ğŸ“© ë©”ì‹œì§€ ìˆ˜ì‹ :", e.data);
  };

  ws.current.onerror = (error) => {
    console.error("âŒ WebSocket ì—ëŸ¬:", error);
  };

  ws.current.onclose = () => {
    console.log("ğŸšª WebSocket ì—°ê²° ì¢…ë£Œ");
  };
};
```
- securityì™€ ë¹„ìŠ·í•˜ê²Œ í•¸ë“¤ëŸ¬ë¥¼ í†µí•´ì„œ ì†Œì¼“ í†µì‹ ì„ ê´€ë¦¬í•˜ê²Œ ëœë‹¤.
- ì´ ì•ˆì—ì„œ ë§ì€ ì˜ˆì™¸ì²˜ë¦¬ê°€ ì¡´ì¬í•œë‹¤ ì˜¤ëŠ˜ ê²½í—˜í•œ ì—ëŸ¬ 
- full authentication is required to access this resource ì´ ë‚´ìš©ì— ëŒ€í•´ ì •ë¦¬í•  í•„ìš”ê°€ ìˆë‹¤.